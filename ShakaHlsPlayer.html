<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SHAKA PLAYER</title>

  <meta name="referrer" content="no-referrer">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/shaka-player.ui.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/controls.min.css">

  <style>
    body {
      position: absolute;
      margin: 0;
      padding: 0;
      background-color: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      height: 100%;
      width: 100%;
    }

    .video-container {
      position: absolute;
      width: 100%;
      height: 100%;
      aspect-ratio: 16/9;
      background-color: #000;
      border-radius: 1px;
      overflow: hidden;
      box-shadow: 0 4px 2px rgba(0, 0, 0, 0.5);
    }

    .shaka-video-container {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    video {
      width: 100%;
      height: 100%;
      background-color: #000;
    }

    @media (max-width: 768px) {
      body {
        width: 100%;
        height: 100%;
        padding: 1px;
      }

      .video-container {
        max-width: 100%;
        height: 100%;
      }
    }

    @media (min-width: 769px) and (max-width: 1024px) {
      .video-container {
        max-width: 854px;
      }
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      background: #000;
      font-family: system-ui, -apple-system, sans-serif;
    }

    /* Roboto Font */
    @font-face {
      font-family: 'Roboto';
      font-style: normal;
      font-weight: 400;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/roboto/v27/KFOmCnqEu92Fr1Me5Q.ttf) format('truetype');
    }
    @font-face {
      font-family: 'Roboto';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/roboto/v27/KFOlCnqEu92Fr1MmEU9vAw.ttf) format('truetype');
    }

    .youtube-theme {
      font-family: 'Roboto', sans-serif;
    }

    /* Hide Shaka Player spinner */
    .shaka-spinner-container,
    .shaka-spinner,
    .shaka-spinner-svg {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
    }

    /* Custom Seek Bar Colors */
    .youtube-theme .shaka-seek-bar {
      background: rgba(255, 255, 255, .2) !important;
    }
    .youtube-theme .shaka-buffered-range {
      background: rgba(255, 255, 255, .4) !important;
    }
    .youtube-theme .shaka-played-range {
      background: rgb(255, 0, 0) !important;
    }

    /* Manual Play Button */
    .manual-play-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px 30px;
      border-radius: 28px;
      cursor: pointer;
      font-size: 18px;
      z-index: 2000;
      border: 0 solid #ff0000;
      display: none;
      transition: all 0.3s ease;
    }

    .manual-play-button:hover {
      background: rgba(255, 0, 0, 0.8);
      transform: translate(-50%, -50%) scale(1.05);
    }
  </style>
</head>

<body>
  <div class="video-container">
    <div class="shaka-video-container" data-shaka-player>
      <video id="video" autoplay muted playsinline preload="auto"></video>
    </div>
  </div>

  <script>
    const queryParams = new URLSearchParams(window.location.search);
    const url = queryParams.get('url');

    const channelstreamInfo = {
      streamUrl: url,
      authBearer: "",
      streamPoster: "https://raw.githubusercontent.com/abusaeeidx/Tv-Channel-Logo/heads/main/CricHD/runded/1745008895589.png"
    };

    let player;
    const video = document.getElementById('video');

    async function initializePlayer() {
      try {
        player = new shaka.Player();
        await player.attach(video);

        const container = document.querySelector('.shaka-video-container');
        const ui = new shaka.ui.Overlay(player, container, video);

        const config = {
          'seekBarColors': {
            base: 'rgba(255,255,255,.2)',
            buffered: 'rgba(255,255,255,.4)',
            played: 'rgb(255,0,0)',
          },
          'controlPanelElements': [
            'play_pause',
            'mute',
            'time_and_duration',
            'restart',
            'spacer',
            'quality',
            'language',
            'picture_in_picture',
            'fullscreen',
            'overflow_menu'
          ]
        };

        ui.configure(config);
        const controls = ui.getControls();

        player.configure({
          streaming: {
            bufferingGoal: 10,
            rebufferingGoal: 2,
            bufferBehind: 30
          },
          manifest: {
            retryParameters: {
              timeout: 30000,
              maxAttempts: 2,
              baseDelay: 1000,
              backoffFactor: 2,
              fuzzFactor: 0.5
            }
          }
        });

        video.autoplay = true;
        video.controls = false;
        video.volume = 1;
        video.muted = false;
        video.preload = 'auto';

        console.log(`Loading stream: ${channelstreamInfo.streamUrl}`);
        await player.load(channelstreamInfo.streamUrl);
        console.log('Stream loaded successfully.');

        const attemptAutoplay = async () => {
          try {
            await video.play();
            console.log('Autoplay successful');
          } catch (playError) {
            console.log('Autoplay blocked, trying with muted audio');
            video.muted = true;
            try {
              await video.play();
              console.log('Autoplay successful with muted audio');
            } catch (mutedError) {
              console.log('Autoplay failed completely, user interaction required');
            }
          }
        };

        if (video.readyState >= 2) {
          await attemptAutoplay();
        } else {
          video.addEventListener('canplay', attemptAutoplay, { once: true });
        }

      } catch (error) {
        console.error('Error initializing player:', error);
        video.src = channelstreamInfo.streamUrl;
        video.autoplay = true;
        video.muted = false;

        try {
          await video.play();
        } catch (fallbackError) {
          video.muted = true;
          await video.play();
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      initializePlayer().catch(error => {
        console.error('Error initializing player:', error);
      });
    });
  </script>
</body>
</html>
